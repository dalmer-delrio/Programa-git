<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>La Ferretería del Barrio — Inicio</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="/css/style.css" />
  </head>

  <body>
    <!-- HEADER -->
    <header class="shadow-sm sticky-top bg-white">
      <nav class="navbar navbar-expand-lg container py-2">
        <a class="navbar-brand d-flex align-items-center gap-2" href="/">
          <img src="images/logo.png" width="44" height="44" alt="Logo" />
          <span class="brand-name">La Ferretería del Barrio</span>
        </a>

        <div class="ms-auto d-flex align-items-center gap-3">
          <form class="search-inline d-flex align-items-center" action="/catalogo" method="get" role="search">
            <input class="form-control form-control-sm" type="search" name="q" placeholder="Buscar..." />
            <button class="btn btn-sm" type="submit">Buscar</button>
          </form>

          <div class="d-none d-lg-flex align-items-center gap-3">
            <a class="nav-link px-2 fw-semibold text-dark" href="/">Inicio</a>
            <a class="nav-link px-2 text-muted" href="/catalogo">Catálogo</a>
            <a class="nav-link px-2 text-muted" href="/ofertas">Ofertas</a>
            <a class="nav-link px-2 text-muted" href="/contacto">Contáctenos</a>

            <a class="btn btn-brand position-relative" href="/carrito_publico">
              Carrito
              <span id="cartCount" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-dark">0</span>
            </a>

            <a id="loginBtn" class="btn btn-outline-dark ms-2" href="/login">Iniciar sesión</a>
          </div>
        </div>
      </nav>
    </header>

    <!-- HERO -->
    <main class="container my-4">

      <section class="p-4 p-md-5 mb-4 bg-light rounded-3 hero">
        <div class="container-fluid py-3">
          <h1 class="display-6 fw-bold">Bienvenido a La Ferretería del Barrio</h1>
          <p class="col-md-8 fs-6">
            Herramientas y materiales para tus proyectos. Revisa ofertas y explora el catálogo.
          </p>
          <a href="/catalogo" class="btn btn-brand">Ver catálogo</a>
        </div>
      </section>

      <!-- Carrusel -->
      <section class="mb-5">
        <div class="d-flex align-items-center justify-content-between">
          <h2 class="h5 mb-0">Ofertas y promociones</h2>
          <a href="/ofertas" class="small">Ver todas →</a>
        </div>

        <div class="carousel-css mt-3">
          <div class="track">
            <div class="slide"><img src="assets/products/prod_1.jpg" alt="Oferta" /></div>
            <div class="slide"><img src="assets/products/prod_2.jpg" alt="Oferta" /></div>
            <div class="slide"><img src="assets/products/prod_3.jpg" alt="Oferta" /></div>
            <div class="slide"><img src="assets/products/prod_4.jpg" alt="Oferta" /></div>
          </div>
          <div class="carousel-dots"><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>
        </div>
      </section>

      <!-- PRODUCTOS DINÁMICOS POR CATEGORÍA -->
      <% if (Object.keys(categorias).length === 0) { %>
        <p class="text-center text-muted">No hay productos disponibles por ahora.</p>
      <% } else { %>

        <% Object.keys(categorias).forEach(cat => { %>
          <section class="mb-5">
            <div class="d-flex align-items-center justify-content-between">
              <h2 class="h5 mb-0"><%= cat %></h2>
              <a class="small" href="/catalogo">Ver catálogo →</a>
            </div>

            <div class="row g-3 mt-2">
              <% categorias[cat].forEach(p => { %>
                <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                  <div class="card card-product h-100 position-relative">
                    
                    <!-- Imagen desde carpeta real -->
                    <img 
                      src="/images/productos/<%= p.imagen || 'placeholder.png' %>" 
                      class="card-img-top"
                      alt="<%= p.nombre_producto %>"
                    />

                    <div class="card-body">
                      <h3 class="h6 card-title mb-1"><%= p.nombre_producto %></h3>
                      <div class="small text-muted mb-2"><%= cat %></div>

                      <div class="d-flex align-items-center gap-2">
                        <span class="price">$ <%= p.precio.toLocaleString() %></span>
                      </div>

                      <!-- Botón agregar al carrito -->
                      <button
                        class="btn btn-brand add-cart"
                        data-id="<%= p.id_producto %>"
                        data-nombre="<%= p.nombre_producto %>"
                        data-precio="<%= p.precio %>"
                        data-imagen="<%= p.imagen %>"
                      >
                        Agregar al carrito
                      </button>
                    </div>
                  </div>
                </div>
              <% }) %>
            </div>
          </section>
        <% }) %>

      <% } %>

    </main>

    <!-- FOOTER -->
    <footer class="mt-5 py-4 bg-light-subtle border-top">
      <div class="container small d-flex flex-wrap gap-2 justify-content-between align-items-center">
        <span>© 2025 La Ferretería del Barrio</span>
        <span class="text-muted">Dalmer Del Rio.</span>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/carritoPublico.js"></script>
  </body>
</html>