<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Panel del Cliente - La FerreterÃ­a del Barrio</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
  </head>

  <body>
    <!-- ðŸ”¹ SIDEBAR -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <img src="/img/logo.png" alt="Logo" class="logo-sidebar" />
        <h2>FerreterÃ­a</h2>
        <button id="toggleSidebar" class="toggle-btn">
          <i class="fas fa-bars"></i>
        </button>
      </div>
      <nav class="menu-sidebar">
        <a href="/dashboard" class="active"
          ><i class="fas fa-home"></i> <span>Inicio</span></a
        >
        <a href="/ofertas"><i class="fas fa-tags"></i> <span>Ofertas</span></a>
        <a href="/carrito"
          ><i class="fas fa-shopping-cart"></i> <span>Carrito</span></a
        >
        <a href="/perfil"
          ><i class="fas fa-user-cog"></i> <span>ConfiguraciÃ³n</span></a
        >
        <a href="/historial"
          ><i class="fas fa-clock-rotate-left"></i> <span>Historial</span></a
        >
        <a href="/soporte"
          ><i class="fas fa-headset"></i> <span>Soporte</span></a
        >
      </nav>
    </aside>

    <!-- ðŸ”¹ HEADER -->
    <header class="dashboard-header">
      <h2 class="titulo-bienvenida">
        Â¡Bienvenido, <%= usuario.nombre || "Cliente" %>! ðŸ‘‹
      </h2>
      <form action="/logout" method="POST" class="logout-inline">
        <button type="submit" class="btn-logout">Cerrar sesiÃ³n</button>
      </form>
    </header>

    <!-- ðŸ”¹ CONTENIDO PRINCIPAL -->
    <main class="dashboard-container">
      <h1>Â¿QuÃ¨ quieres comprar hoy?</h1>

      <% if (productos.length > 0) { %> <% // Agrupamos productos por categorÃ­a
      const categorias = {}; productos.forEach(p => { if
      (!categorias[p.nombre_categoria]) categorias[p.nombre_categoria] = [];
      categorias[p.nombre_categoria].push(p); }); %> <%
      Object.keys(categorias).forEach(cat => { %>
      <section class="categoria">
        <h2><%= cat %></h2>
        <div class="productos-grid">
          <% categorias[cat].forEach(producto => { %>
          <div class="producto-card">
            <img
              src="/images/productos/<%= producto.imagen || 'default.png' %>"
              alt="<%= producto.nombre_producto %>"
            />
            <h3><%= producto.nombre_producto %></h3>
            <p>$<%= producto.precio.toLocaleString() %></p>

            <form action="/carrito/agregar" method="POST" class="form-agregar">
              <input
                type="hidden"
                name="id_producto"
                value="<%= producto.id_producto %>"
              />
              <div class="cantidad-container">
                <label for="cantidad_<%= producto.id_producto %>"
                  >Cantidad:</label
                >
                <input
                  type="number"
                  id="cantidad_<%= producto.id_producto %>"
                  name="cantidad"
                  value="1"
                  min="1"
                />
              </div>
              <button type="submit" class="btn-agregar">
                <i class="fas fa-cart-plus"></i> Agregar
              </button>
            </form>
          </div>
          <% }) %>
        </div>
      </section>
      <% }) %> <% } else { %>
      <p>No hay productos disponibles por el momento.</p>
      <% } %>
    </main>

    <!-- ðŸ”¹ ESTILOS -->
    <style>
      body {
        margin: 0;
        font-family: "Poppins", sans-serif;
        background: #f5f6fa;
        display: flex;
      }

      /* SIDEBAR */
      .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        height: 100vh;
        width: 230px;
        background: #1a73e8;
        color: white;
        padding: 10px;
        display: flex;
        flex-direction: column;
        transition: width 0.3s ease;
        box-sizing: border-box;
      }

      .sidebar-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .logo-sidebar {
        width: 40px;
        height: 40px;
      }

      .menu-sidebar {
        margin-top: 40px;
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .menu-sidebar a {
        color: white;
        text-decoration: none;
        font-size: 0.95rem;
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 15px;
        border-radius: 8px;
        transition: background 0.2s ease;
      }

      .menu-sidebar a:hover,
      .menu-sidebar a.active {
        background: rgba(255, 255, 255, 0.2);
      }

      /* HEADER */
      .dashboard-header {
        position: fixed;
        top: 0;
        left: 230px;
        right: 0;
        height: 70px;
        background: white;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0 30px;
        z-index: 100;
      }

      .titulo-bienvenida {
        color: #1a73e8;
        text-align: center;
        margin: 0;
        font-weight: 600;
      }

      .btn-logout {
        background: #e53935;
        border: none;
        color: white;
        padding: 7px 12px;
        border-radius: 6px;
        cursor: pointer;
        position: absolute;
        right: 30px;
      }

      /* CONTENIDO PRINCIPAL */
      .dashboard-container {
        margin-left: 240px;
        margin-top: 90px;
        padding: 30px;
        flex: 1;
      }

      .categoria {
        margin-bottom: 50px;
      }

      .categoria h2 {
        color: #1a73e8;
        border-left: 5px solid #1a73e8;
        padding-left: 10px;
        text-transform: capitalize;
        margin-bottom: 20px;
      }

      .productos-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 20px;
      }

      .producto-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        padding: 15px;
        text-align: center;
        transition: transform 0.3s;
      }

      .producto-card:hover {
        transform: translateY(-6px);
      }

      .producto-card img {
        width: 100%;
        height: 150px;
        object-fit: cover;
        border-radius: 10px;
        margin-bottom: 10px;
      }

      .precio {
        color: #2e7d32;
        font-weight: 600;
        margin: 8px 0;
      }

      .btn-agregar {
        background: #1a73e8;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 6px;
        cursor: pointer;
      }

      .btn-agregar:hover {
        background: #0f5cd8;
      }

      /* RESPONSIVE */
      @media (max-width: 768px) {
        .sidebar {
          position: fixed;
          height: auto;
          flex-direction: row;
          width: 100%;
          bottom: 0;
          top: auto;
          justify-content: space-around;
        }

        .dashboard-header {
          left: 0;
        }

        .dashboard-container {
          margin-left: 0;
          margin-top: 80px;
        }
      }

      .categoria-section {
        margin-top: 40px;
        text-align: left;
      }

      .categoria-section h2 {
        color: #1a73e8;
        font-size: 1.5rem;
        margin-bottom: 20px;
      }

      .productos-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
      }

      .producto-card {
        background: #fff;
        padding: 15px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }

      .producto-card:hover {
        transform: translateY(-5px);
      }

      .producto-card img {
        width: 100%;
        height: 150px;
        object-fit: contain;
        margin-bottom: 10px;
      }

      .precio {
        color: #2e7d32;
        font-weight: bold;
        margin: 10px 0;
      }
      .categoria-section {
        margin-top: 40px;
        text-align: left;
      }

      .categoria-section h2 {
        color: #1a73e8;
        margin-bottom: 15px;
        border-bottom: 2px solid #1a73e8;
        display: inline-block;
        padding-bottom: 5px;
      }

      .productos-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
      }

      .producto-card {
        background: white;
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        text-align: center;
      }

      .producto-card img {
        width: 100%;
        height: 150px;
        object-fit: contain;
        border-radius: 6px;
        margin-bottom: 10px;
      }

      .producto-card h3 {
        font-size: 1rem;
        margin: 5px 0;
      }

      .producto-card p {
        color: #333;
        font-weight: bold;
        margin-bottom: 10px;
      }

      /* ðŸ›’ CatÃ¡logo de productos */
      .categoria {
        margin-bottom: 40px;
        text-align: left;
      }

      .categoria h2 {
        color: #1a73e8;
        border-bottom: 2px solid #1a73e8;
        padding-bottom: 5px;
        margin-bottom: 20px;
      }

      .productos-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 20px;
      }

      .producto-card {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        padding: 15px;
        text-align: center;
        transition: transform 0.2s ease;
      }

      .producto-card:hover {
        transform: translateY(-5px);
      }

      .producto-card img {
        width: 100%;
        height: 140px;
        object-fit: contain;
      }

      .form-agregar {
        margin-top: 10px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
      }

      .cantidad-container {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .cantidad-container input {
        width: 60px;
        text-align: center;
        padding: 5px;
        border-radius: 5px;
        border: 1px solid #ccc;
      }

      .btn-agregar {
        background: #1a73e8;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.3s;
      }

      .btn-agregar:hover {
        background: #0d5ecf;
      }

      /* ====== Sidebar colapsable ====== */
      .sidebar.collapsed {
        width: 70px;
      }

      .sidebar.collapsed .sidebar-header h2,
      .sidebar.collapsed .menu-sidebar span {
        display: none;
      }

      .sidebar.collapsed .logo-sidebar {
        margin: 0 auto;
      }

      /* ====== Header ajustable ====== */
      .dashboard-header {
        transition: left 0.3s ease;
      }

      .dashboard-header.collapsed {
        left: 70px;
      }

      /* ====== Contenido ajustable ====== */
      .dashboard-container {
        transition: margin-left 0.3s ease;
      }

      .dashboard-container.collapsed {
        margin-left: 80px;
      }
    </style>

    <script>
  document.getElementById("toggleSidebar").addEventListener("click", () => {
    const sidebar = document.getElementById("sidebar");
    const header = document.querySelector(".dashboard-header");
    const content = document.querySelector(".dashboard-container");

    sidebar.classList.toggle("collapsed");
    header.classList.toggle("collapsed");
    content.classList.toggle("collapsed");
  });
</script>
  </body>
</html>
